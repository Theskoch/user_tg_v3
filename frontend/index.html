<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>Mini App</title>

  <link rel="stylesheet" href="/styles.css?v=1"/>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <!-- QR render -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
  <!-- QR scan -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>

  <script src="/app.js?v=1" defer></script>
</head>
<body>

<div id="notTelegram" class="center" style="display:none">
  <div class="card">
    <div class="h1">–û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞</div>
    <div class="muted">–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram.</div>
  </div>
</div>

<div id="inviteScreen" class="center" style="display:none">
  <div class="card">
    <div class="h1">–î–æ—Å—Ç—É–ø –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç</div>
    <div class="muted">–í–≤–µ–¥–∏—Ç–µ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∫–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è.</div>

    <input id="inviteInput" class="input" placeholder="–ö–æ–¥ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è"/>
    <button id="inviteBtn" class="btn primary" type="button">–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å—Å—è</button>

    <div id="inviteErr" class="err" style="display:none"></div>
  </div>
</div>

<div id="app" class="app" style="display:none">
  <!-- TOPBAR -->
  <div id="topbar" class="topbar">
    <div class="left">
      <div id="avatar" class="avatar">U</div>
      <button id="balanceBtn" class="balance" type="button">
        <div class="muted small">–ë–∞–ª–∞–Ω—Å</div>
        <div id="balanceVal" class="balanceVal">‚Äî</div>
      </button>
    </div>

    <div class="menu">
      <button id="burger" class="burger" type="button" aria-label="menu">
        <span></span><span></span><span></span>
      </button>
      <div id="dropdown" class="dropdown" style="display:none">
        <button id="topupMenuBtn" class="dropBtn" type="button">–ü–æ–ø–æ–ª–Ω–∏—Ç—å</button>
        <button id="adminMenuBtn" class="dropBtn" type="button" style="display:none">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</button>
      </div>
    </div>
  </div>

  <!-- PAGES -->
  <div class="pages">

    <!-- HOME -->
    <div id="pageHome" class="page page-active">
      <div class="card">
        <div class="row">
          <div>
            <div class="muted small">–¢–∞—Ä–∏—Ñ</div>
            <div id="tariffName" class="h2">‚Äî</div>
            <div id="tariffPrice" class="muted">‚Äî</div>
          </div>
          <div id="roleBadge" class="badge">‚Äî</div>
        </div>
      </div>

      <div class="card">
        <div class="h2">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏—è</div>
        <div id="myConfigs" class="list"></div>
      </div>
    </div>

    <!-- TOPUP -->
    <div id="pageTopup" class="page">
      <div class="pageHead">
        <button id="backFromTopup" class="btn ghost" type="button">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="h2">–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ</div>
      </div>

      <div class="card">
        <div class="grid">
          <button class="btn" type="button">‚≠êÔ∏è –ó–∞ –∑–≤–µ–∑–¥—ã</button>
          <button class="btn" type="button">ü™ô –ö—Ä–∏–ø—Ç–∞</button>
          <button class="btn" type="button">üè¶ –ü–µ—Ä–µ–≤–æ–¥</button>
        </div>
        <div class="muted small" style="margin-top:10px">–ü–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∏.</div>
      </div>
    </div>

    <!-- ADMIN LIST -->
    <div id="pageAdmin" class="page">
      <div class="pageHead">
        <button id="backFromAdmin" class="btn ghost" type="button">‚Üê –ù–∞–∑–∞–¥</button>
        <div class="h2">–ê–¥–º–∏–Ω</div>
      </div>

      <div class="card">
        <div class="h2">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è</div>
        <div class="muted small">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥:</div>

        <div class="inviteBox">
          <div id="inviteCodeValue" class="inviteCode">‚Äî</div>
          <button id="copyInviteBtn" class="btn primary" type="button">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </div>

        <div class="grid" style="margin-top:12px">
          <button id="inviteUserBtn" class="btn" type="button">+ User</button>
          <button id="inviteAdminBtn" class="btn" type="button">+ Admin</button>
        </div>

        <div id="inviteGenErr" class="err" style="display:none"></div>
      </div>

      <div class="card">
        <div class="h2">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</div>
        <div id="adminUsers" class="list"></div>
      </div>
    </div>

    <!-- ADMIN USER -->
    <div id="pageAdminUser" class="page">
      <div class="pageHead">
        <button id="backFromAdminUser" class="btn ghost" type="button">‚Üê –ù–∞–∑–∞–¥</button>
        <div id="adminUserTitle" class="h2">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
      </div>

      <div class="card">
        <div class="h2">–¢–∞—Ä–∏—Ñ</div>
        <div class="row" style="margin-top:8px">
          <div class="muted">–¢–µ–∫—É—â–∏–π:</div>
          <div id="adminTariffNow" class="badge">‚Äî</div>
        </div>

        <select id="adminTariffSelect" class="select"></select>
        <button id="adminSaveTariff" class="btn primary" style="margin-top:10px" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞—Ä–∏—Ñ</button>
        <div id="adminTariffErr" class="err" style="display:none"></div>
      </div>

      <div class="card">
        <div class="h2">–ë–∞–ª–∞–Ω—Å</div>
        <div class="row" style="margin-top:8px">
          <div class="muted">–¢–µ–∫—É—â–∏–π:</div>
          <div id="adminBalanceNow" class="badge">‚Äî</div>
        </div>

        <input id="adminBalanceInput" class="input" placeholder="–ù–æ–≤—ã–π –±–∞–ª–∞–Ω—Å (—á–∏—Å–ª–æ)"/>
        <button id="adminSaveBalance" class="btn primary" style="margin-top:10px" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å</button>
        <div id="adminBalanceErr" class="err" style="display:none"></div>
      </div>

      <div class="card">
        <div class="row">
          <div class="h2">–ö–æ–Ω–Ω–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
          <button id="addConnBtn" class="btn" type="button">+</button>
        </div>

        <div id="adminConfigs" class="list" style="margin-top:10px"></div>
      </div>

      <div class="card">
        <button id="deleteUserBtn" class="btn danger" type="button">–£–¥–∞–ª–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
      </div>
    </div>

  </div>
</div>

<!-- SHEET: view config -->
<div id="sheetOverlay" class="overlay" style="display:none"></div>
<div id="sheet" class="sheet" style="display:none">
  <div class="row">
    <div id="sheetTitle" class="h2">–ö–æ–Ω—Ñ–∏–≥</div>
    <button id="closeSheet" class="btn ghost" type="button">‚úï</button>
  </div>
  <div id="qrWrap" class="qrWrap"></div>
  <div id="cfgTextBox" class="cfgBox">
    <div class="muted small">–ù–∞–∂–º–∏—Ç–µ, —á—Ç–æ–±—ã —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</div>
    <pre id="sheetText" class="pre"></pre>
  </div>
</div>

<!-- ADD CONFIG PANEL -->
<div id="addModal" class="overlay" style="display:none"></div>
<div id="addPanel" class="sheet" style="display:none">
  <div class="row">
    <div class="h2">–î–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç</div>
    <button id="cancelAdd" class="btn ghost" type="button">‚úï</button>
  </div>

  <textarea id="addText" class="textarea" placeholder="–í—Å—Ç–∞–≤—å —Ç–µ–∫—Å—Ç –∏–ª–∏ —Å–∫–∞–Ω–∏—Ä—É–π QR"></textarea>

  <div class="grid" style="margin-top:10px">
    <button id="scanBtn" class="btn" type="button">–°–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR</button>
    <button id="saveBtn" class="btn primary" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>

  <div id="addErr" class="err" style="display:none"></div>
</div>

<!-- QR SCANNER -->
<div id="qrModal" class="overlay" style="display:none"></div>
<div id="qrPanel" class="sheet" style="display:none">
  <div class="row">
    <div class="h2">–°–∫–∞–Ω–µ—Ä QR</div>
    <button id="closeQr" class="btn ghost" type="button">‚úï</button>
  </div>
  <video id="qrVideo" class="video" playsinline></video>
  <canvas id="qrCanvas" style="display:none"></canvas>
  <div id="qrHint" class="muted small" style="margin-top:8px">–ù–∞–≤–µ–¥–∏ –∫–∞–º–µ—Ä—É –Ω–∞ QR</div>
</div>

</body>
</html>
